# Wingz – Python/Django Developer Test

## Objective

Create a RESTful API using Django REST Framework for managing ride information.

---

## Core Requirements

### 1. Utilize Django REST Framework

* Create necessary models for **Ride**, **User**, and **RideEvent**
* Implement serializers for the models to enable JSON serialization/deserialization
* Use Viewsets for managing CRUD operations

---

### 2. Authentication

* Implement authentication to ensure only users with the role `"admin"` can access the API

---

### 3. Ride List API

Implement an API which returns a list of **Rides**.

Requirements:

* Each Ride should include related **RideEvents** and **Users** (`id_rider`, `id_driver`)
* Support pagination
* Support filtering:

  * Ride status
  * Rider email
* Support sorting by:

  * `pickup_time`
  * Distance to pickup given a GPS position as input in the same API

Sorting requirements:

* Must implement both sorting options as efficiently as possible
* Assume the Ride table will be very large
* Sorting implementation must still support pagination

---

### 4. Performance

* Since we anticipate that the **RideEvent** table will be very large, the Ride List API should return an additional field on Ride named:

  ```
  todays_ride_events
  ```

  This field should only retrieve RideEvents that occurred in the last 24 hours.

* For performance reasons:

  * Do NOT retrieve the full list of RideEvents in SQL queries generated by Django
  * Use advanced Django features to retrieve this data while minimizing SQL queries

* The number of database queries for the Ride List API should be minimized

  Retrieving the ride list with related driver, rider, and RideEvents can be achieved with:

  * 2 queries
  * 3 queries if including the count query used for pagination

---

## Table Definitions

---

### Ride Table

| Field             | Data Type | Description                                         |
| ----------------- | --------- | --------------------------------------------------- |
| id_ride           | INT       | Primary key                                         |
| status            | VARCHAR   | Ride status (e.g., "en-route", "pickup", "dropoff") |
| id_rider          | INT       | Foreign key referencing User(id_user)               |
| id_driver         | INT       | Foreign key referencing User(id_user)               |
| pickup_latitude   | FLOAT     | Latitude of pickup location                         |
| pickup_longitude  | FLOAT     | Longitude of pickup location                        |
| dropoff_latitude  | FLOAT     | Latitude of dropoff location                        |
| dropoff_longitude | FLOAT     | Longitude of dropoff location                       |
| pickup_time       | DATETIME  | Pickup time                                         |

---

### User Table

| Field        | Data Type | Description                        |
| ------------ | --------- | ---------------------------------- |
| id_user      | INT       | Primary key                        |
| role         | VARCHAR   | User role ("admin" or other roles) |
| first_name   | VARCHAR   | User's first name                  |
| last_name    | VARCHAR   | User's last name                   |
| email        | VARCHAR   | User's email address               |
| phone_number | VARCHAR   | User's phone number                |

---

### Ride_Event Table

| Field         | Data Type | Description                           |
| ------------- | --------- | ------------------------------------- |
| id_ride_event | INT       | Primary key                           |
| id_ride       | INT       | Foreign key referencing Ride(id_ride) |
| description   | VARCHAR   | Description of the ride event         |
| created_at    | DATETIME  | Timestamp of when the event occurred  |

---

## Submission

* Django project source code hosted on a version control repository (e.g., GitHub)
* Ensure commit history is clean and meaningful, showing project progression
* README must:

  * Be comprehensive
  * Help any developer set up the project without hassle
  * Include additional notes or comments regarding design decisions or challenges faced during implementation

---

## Evaluation Criteria

* **Functionality**
  Does the application perform all defined requirements?

* **Code Quality**
  Is the code modular, readable, and maintainable?

* **Error Handling**
  Are errors and edge cases handled properly?

* **Performance**
  Is the API optimized to use the minimal number of SQL queries sent to the database?

---

## Bonus – SQL

For reporting purposes, include a **raw SQL statement** (add it in the README) that:

* Returns the count of Trips that took more than **1 hour** from Pickup to Dropoff
* Group results by:

  * Month
  * Driver

### Sample Output

| Month   | Driver   | Count of Trips > 1 hr |
| ------- | -------- | --------------------- |
| 2024-01 | Chris H  | 4                     |
| 2024-01 | Howard Y | 5                     |
| 2024-01 | Randy W  | 2                     |
| 2024-02 | Chris H  | 7                     |
| 2024-02 | Howard Y | 5                     |
| 2024-03 | Chris H  | 2                     |
| 2024-03 | Howard Y | 2                     |
| 2024-03 | Randy W  | 11                    |
| 2024-04 | Howard Y | 7                     |
| 2024-04 | Randy W  | 3                     |

---

### Important Notes for SQL Calculation

* When a driver picks up a rider, a `Ride_Event` will be created with description:

  ```
  "Status changed to pickup"
  ```

* When a rider is dropped off, a `Ride_Event` will be created with description:

  ```
  "Status changed to dropoff"
  ```

* To calculate trip duration:

  * Find the pickup and dropoff RideEvents for each ride
  * Calculate the time difference

* You do NOT need to implement the code that populates the Ride_Event table
  Assume it is already populated for the SQL report.

* Ideally, in a real-world scenario, distance would be stored in the Ride table.
  However, for this assessment, assume the Ride table structure cannot be changed.

